<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>Etes-vous un super défenseur du climat ?</title>
        <!-- lien vers la bibliothèque bootstrap -->
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
        <!-- lien vers le script contenant la fonction getXMLHttpRequest-->
        <script type="text/javascript" src="oXHR.js"></script>
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript">
            // pointeur sur la position de l'article courant dans le catalogue
            var index = 0;
            // initialisation du catalogue
            var catalogue = [];

            function executerRequete(callback) {
                // on vérifie si le catalogue a déjà été chargé pour n'exécuter la requête AJAX
                // qu'une seule fois
                if (catalogue.length === 0) {
                    // on récupère un objet XMLHttpRequest
                    var xhr = getXMLHttpRequest();
                    // on réagit à l'événement onreadystatechange
                    xhr.onreadystatechange = function() {
                        // test du statut de retour de la requête AJAX
                        if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                            // on désérialise le catalogue et on le sauvegarde dans une variable
                            catalogue = JSON.parse(xhr.responseText);
                            // on lance la fonction de callback avec le catalogue récupéré
                            callback();
                        }
                    }
                    // la requête AJAX : lecture de data.json
                    xhr.open("GET", "quizz.json", true);
                    xhr.send();
                } else {
                    // on lance la fonction de callback avec le catalogue déjà récupéré précédemment
                    callback();
                }
            }

            function lireSuivant() {
                // connaitre le nombre d'articles dans le catalogue
                var longueur = catalogue.length;
                // manipulation du DOM pour afficher les caractéristiques de l'article
                document.getElementById("quest").innerHTML = catalogue[index].libelle_question;
                // efface les div de réponse
                for (i=0; i<8; i++)
                {
                    var numdiv="cont"+i;
                    document.getElementById(numdiv).style.display = "none";
                }  
                // connaitre le nombre de réponse à afficher
                nbReponse = catalogue[index].nbr_reponse;
                for (i=0; i<nbReponse; i++)
                {
                    var numlabel='lab'+i;
                    var numdiv="cont"+i;
                    document.getElementById(numdiv).style.display = "block";
                    document.getElementById(numlabel).textContent = catalogue[index].reponse[i].libelle_reponse;
                }    
                if (index < longueur - 1) {
                    index++;
                }
            }
            
            // function lirePrecedent() {
            //     document.getElementById("nom").innerHTML = catalogue[index].nom;
            //     document.getElementById("desc").innerHTML = catalogue[index].desc;
            //     document.getElementById("qte").innerHTML = catalogue[index].qte;
            //     document.getElementById("prix").innerHTML = catalogue[index].prix;
            //     if (index > 0) {
            //         index--;
            //     }
            // }

            // on initialise la lecture au premier élément
            executerRequete(lireSuivant);
        </script>
    </head>
    <body>
        <section class="container">
            <article name="données" class="well form-inline pull-left col-lg-8">
                <legend>Quizz Nature18</legend>
                <label id = "quest"></label><br>
                <label class="container" id="cont0">
                    <input type="radio" name="radio" id="rep0">
                    <label id="lab0" for="rep0"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont1">
                    <input type="radio" name="radio" id="rep1">
                    <label id="lab1" for="rep1"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont2" style="display:none">
                    <input type="radio" name="radio" id="rep2">
                    <label id="lab2" for="rep2"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont3" style="display:none">
                    <input type="radio" name="radio" id="rep3">
                    <label id="lab3" for="rep3"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont4" style="display:none">
                    <input type="radio" name="radio" id="rep4">
                    <label id="lab4" for="rep4"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont5" style="display:none">
                    <input type="radio" name="radio" id="rep5">
                    <label id="lab5" for="rep5"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont6" style="display:none">
                    <input type="radio" name="radio" id="rep6">
                    <label id="lab6" for="rep6"></label>
                    <span class="checkmark"></span>
                </label>
                <label class="container" id="cont7" style="display:none">
                    <input type="radio" name="radio" id="rep7">
                    <label id="lab7" for="rep7"></label>
                    <span class="checkmark"></span>
                </label>
                <button class="btn btn-primary" type="submit" onclick="executerRequete(lireSuivant)"><span class="glyphicon glyphicon-play"> </span> Question suivante</button>
                <!-- <button class="btn btn-primary" type="submit" onclick="executerRequete(lirePrecedent)"><span class="glyphicon glyphicon-step-backward"> </span> Lecture arrière</button> -->
            </article>
        </section>
        <div class="container-fluid">
            <img src="grass.png" alt="Herbe">
          </div>
        <footer>
            
        </footer>
    </body>
</html>